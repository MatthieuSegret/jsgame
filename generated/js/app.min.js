(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
'use strict';

window.onload = function () {
  // Game
  var game = new Phaser.Game(640, 480, Phaser.AUTO, 'jsgame');
  game.transparent = true;
  game.state.add('play', require('./states/play'));
  game.state.add('gameover', require('./states/gameover'));
  game.state.add('win', require('./states/win'));
  game.state.add('preload', require('./states/preload'));
  game.state.start('preload');
};

},{"./states/gameover":7,"./states/play":8,"./states/preload":9,"./states/win":10}],2:[function(require,module,exports){
'use strict';

// Donne la capacité à un objet de toucher un autre
var Touchable = function() {}

Touchable.prototype.touch = function(target) {
  return this.game.physics.arcade.overlap(this, target);
};

module.exports = Touchable;

},{}],3:[function(require,module,exports){
'use strict';

var Touchable = require('./concerns/touchable');
var StaticObject = require('./staticObject');

// Player hérite de StaticObject
var Monster = function(game, x, y, image_name) {
  this.image_name = _.sample(['ghost1', 'ghost2', 'ghost3', 'dark_knight', 'hornet', 'undead', 'cactuar']);
  StaticObject.call(this, game, x, y, this.image_name);
}
Monster.prototype = Object.create(StaticObject.prototype);
Monster.prototype.constructor = StaticObject;

// Mixins
_.extend(Monster.prototype, Touchable.prototype);

Monster.prototype.follow = function(target) {
  var dirX = this.x < target.x ? -1 : 1;
  this.x -= dirX * 1;

  var dirY = this.y < target.y ? -1 : 1;
  this.y -= dirY * 1;
};

module.exports = Monster;

},{"./concerns/touchable":2,"./staticObject":6}],4:[function(require,module,exports){
'use strict';

var Touchable = require('./concerns/touchable');
var StaticObject = require('./staticObject');

// Player hérite de StaticObject
var Player = function(game, x, y, image_name) {
  this.image_name = image_name || 'player';
  StaticObject.call(this, game, x, y, this.image_name);
}
Player.prototype = Object.create(StaticObject.prototype);
Player.prototype.constructor = StaticObject;

// Mixins
_.extend(Player.prototype, Touchable.prototype);

Player.prototype.moveUp = function() {
  this.y -= 3;
};

Player.prototype.moveDown = function() {
  this.y += 3;
};

Player.prototype.moveLeft = function() {
  this.x -= 3;
};

Player.prototype.moveRight = function() {
  this.x += 3;
};

module.exports = Player;

},{"./concerns/touchable":2,"./staticObject":6}],5:[function(require,module,exports){
'use strict';

var StaticObject = require('./staticObject');

// Ruby hérite de StaticObject
var Ruby = function(game, x, y, image_name) {
  this.image_name = image_name || 'ruby';
  StaticObject.call(this, game, x, y, this.image_name);
}

Ruby.prototype.constructor = StaticObject;
Ruby.prototype = Object.create(StaticObject.prototype);

module.exports = Ruby;

},{"./staticObject":6}],6:[function(require,module,exports){
'use strict';

// StaticOject
var StaticObject = function(game, x, y, image_name) {
  Phaser.Sprite.call(this, game, x, y, image_name);
  //this.anchor.setTo(1, 1);
  this.game.physics.enable(this, Phaser.Physics.ARCADE);
  this.body.collideWorldBounds = true;
  this.body.overlapX = 1;
  this.body.overlapY = 1;
}

StaticObject.prototype = Object.create(Phaser.Sprite.prototype);
StaticObject.prototype.constructor = StaticObject;

module.exports = StaticObject;

},{}],7:[function(require,module,exports){
'use strict';

// GameOver
function GameOver() {};

GameOver.prototype = {
  preload: function() {

  },

  create: function() {
    var style = { font: 'bold 55px Arial', fill: '#ffff00', align: 'center'};
    this.titleText = this.game.add.text(this.game.world.centerX, 275, 'Game Over', style);
    this.titleText.anchor.setTo(0.5, 0.5);
  },

  update: function() {
    if(this.game.input.activePointer.justPressed()) {
      this.game.state.start('play');
    }
  }
};

module.exports = GameOver;

},{}],8:[function(require,module,exports){
'use strict';

var Ruby = require('../prefabs/ruby');
var Player = require('../prefabs/player');
var Monster = require('../prefabs/monster');

// Play
function Play() {};

Play.prototype = {
  preload: function() {
    this.initKey();
  },

  create: function() {
    this.game.add.sprite(0, 0, 'background');

    this.player = new Player(this.game, 570, 400);
    this.game.add.existing(this.player);

    this.ruby = new Ruby(this.game, 45, 95);
    this.game.add.existing(this.ruby);

    this.monsters = [];
    var m;
    _(4).times(_.bind(function(n){
      m = new Monster(this.game, _.random(10, 450), _.random(10, 450));
      this.monsters.push(m);
      this.game.add.existing(m);
    }, this));
  },

  update: function() {
    _.each(this.monsters, _.bind(function(monster) {
      monster.follow(this.player);
      if(monster.touch(this.player)) {
        this.game.state.start('gameover', false);
      }
    }, this));

    if(this.player.touch(this.ruby)) {
      this.game.state.start('win', false);
    }

    if (this.upKey.isDown) { this.player.moveUp(); }
    if (this.downKey.isDown) { this.player.moveDown(); }
    if (this.leftKey.isDown) { this.player.moveLeft(); }
    if (this.rightKey.isDown) { this.player.moveRight(); }
  },

  render: function() {
    //this.game.debug.bodyInfo(this.player, 16, 24);
    //this.game.debug.spriteInfo(this.player);
    //this.game.debug.body(this.player);
    //this.game.debug.body(this.ruby);
  },

  initKey: function() {
    this.upKey = this.game.input.keyboard.addKey(Phaser.Keyboard.UP);
    this.downKey = this.game.input.keyboard.addKey(Phaser.Keyboard.DOWN);
    this.leftKey = this.game.input.keyboard.addKey(Phaser.Keyboard.LEFT);
    this.rightKey = this.game.input.keyboard.addKey(Phaser.Keyboard.RIGHT);
  }
};

module.exports = Play;

},{"../prefabs/monster":3,"../prefabs/player":4,"../prefabs/ruby":5}],9:[function(require,module,exports){
'use strict';

// Preload
function Preload() {}

Preload.prototype = {
  preload: function() {
    this.game.load.image('background', '../images/background.png');
    this.game.load.image('player', 'images/player.png');
    this.game.load.image('ruby', 'images/ruby.png');
    this.game.load.image('ghost1', 'images/ghost1.png');
    this.game.load.image('ghost2', 'images/ghost2.png');
    this.game.load.image('ghost3', 'images/ghost3.png');
    this.game.load.image('dark_knight', 'images/dark_knight.png');
    this.game.load.image('hornet', 'images/hornet.png');
    this.game.load.image('undead', 'images/undead.png');
    this.game.load.image('cactuar', 'images/cactuar.png');
  },

  create: function() {
    this.game.state.start('play');
  },

  update: function() {

  }
};

module.exports = Preload;

},{}],10:[function(require,module,exports){
'use strict';

// Win
function Win() {};

Win.prototype = {
  preload: function() {

  },

  create: function() {
    var style = { font: 'bold 55px Arial', fill: '#ffff00', align: 'center'};
    this.titleText = this.game.add.text(this.game.world.centerX, 275, 'You win !', style);
    this.titleText.anchor.setTo(0.5, 0.5);
  },

  update: function() {
    if(this.game.input.activePointer.justPressed()) {
      this.game.state.start('play');
    }
  }
};

module.exports = Win;

},{}]},{},[1])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJhcHAvamF2YXNjcmlwdHMvYXBwLmpzIiwiYXBwL2phdmFzY3JpcHRzL3ByZWZhYnMvY29uY2VybnMvdG91Y2hhYmxlLmpzIiwiYXBwL2phdmFzY3JpcHRzL3ByZWZhYnMvbW9uc3Rlci5qcyIsImFwcC9qYXZhc2NyaXB0cy9wcmVmYWJzL3BsYXllci5qcyIsImFwcC9qYXZhc2NyaXB0cy9wcmVmYWJzL3J1YnkuanMiLCJhcHAvamF2YXNjcmlwdHMvcHJlZmFicy9zdGF0aWNPYmplY3QuanMiLCJhcHAvamF2YXNjcmlwdHMvc3RhdGVzL2dhbWVvdmVyLmpzIiwiYXBwL2phdmFzY3JpcHRzL3N0YXRlcy9wbGF5LmpzIiwiYXBwL2phdmFzY3JpcHRzL3N0YXRlcy9wcmVsb2FkLmpzIiwiYXBwL2phdmFzY3JpcHRzL3N0YXRlcy93aW4uanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNaQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDekJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2pDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDZEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDeEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2xFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDN0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIid1c2Ugc3RyaWN0Jztcblxud2luZG93Lm9ubG9hZCA9IGZ1bmN0aW9uICgpIHtcbiAgLy8gR2FtZVxuICB2YXIgZ2FtZSA9IG5ldyBQaGFzZXIuR2FtZSg2NDAsIDQ4MCwgUGhhc2VyLkFVVE8sICdqc2dhbWUnKTtcbiAgZ2FtZS50cmFuc3BhcmVudCA9IHRydWU7XG4gIGdhbWUuc3RhdGUuYWRkKCdwbGF5JywgcmVxdWlyZSgnLi9zdGF0ZXMvcGxheScpKTtcbiAgZ2FtZS5zdGF0ZS5hZGQoJ2dhbWVvdmVyJywgcmVxdWlyZSgnLi9zdGF0ZXMvZ2FtZW92ZXInKSk7XG4gIGdhbWUuc3RhdGUuYWRkKCd3aW4nLCByZXF1aXJlKCcuL3N0YXRlcy93aW4nKSk7XG4gIGdhbWUuc3RhdGUuYWRkKCdwcmVsb2FkJywgcmVxdWlyZSgnLi9zdGF0ZXMvcHJlbG9hZCcpKTtcbiAgZ2FtZS5zdGF0ZS5zdGFydCgncHJlbG9hZCcpO1xufTtcbiIsIid1c2Ugc3RyaWN0JztcblxuLy8gRG9ubmUgbGEgY2FwYWNpdMOpIMOgIHVuIG9iamV0IGRlIHRvdWNoZXIgdW4gYXV0cmVcbnZhciBUb3VjaGFibGUgPSBmdW5jdGlvbigpIHt9XG5cblRvdWNoYWJsZS5wcm90b3R5cGUudG91Y2ggPSBmdW5jdGlvbih0YXJnZXQpIHtcbiAgcmV0dXJuIHRoaXMuZ2FtZS5waHlzaWNzLmFyY2FkZS5vdmVybGFwKHRoaXMsIHRhcmdldCk7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFRvdWNoYWJsZTtcbiIsIid1c2Ugc3RyaWN0JztcblxudmFyIFRvdWNoYWJsZSA9IHJlcXVpcmUoJy4vY29uY2VybnMvdG91Y2hhYmxlJyk7XG52YXIgU3RhdGljT2JqZWN0ID0gcmVxdWlyZSgnLi9zdGF0aWNPYmplY3QnKTtcblxuLy8gUGxheWVyIGjDqXJpdGUgZGUgU3RhdGljT2JqZWN0XG52YXIgTW9uc3RlciA9IGZ1bmN0aW9uKGdhbWUsIHgsIHksIGltYWdlX25hbWUpIHtcbiAgdGhpcy5pbWFnZV9uYW1lID0gXy5zYW1wbGUoWydnaG9zdDEnLCAnZ2hvc3QyJywgJ2dob3N0MycsICdkYXJrX2tuaWdodCcsICdob3JuZXQnLCAndW5kZWFkJywgJ2NhY3R1YXInXSk7XG4gIFN0YXRpY09iamVjdC5jYWxsKHRoaXMsIGdhbWUsIHgsIHksIHRoaXMuaW1hZ2VfbmFtZSk7XG59XG5Nb25zdGVyLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoU3RhdGljT2JqZWN0LnByb3RvdHlwZSk7XG5Nb25zdGVyLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IFN0YXRpY09iamVjdDtcblxuLy8gTWl4aW5zXG5fLmV4dGVuZChNb25zdGVyLnByb3RvdHlwZSwgVG91Y2hhYmxlLnByb3RvdHlwZSk7XG5cbk1vbnN0ZXIucHJvdG90eXBlLmZvbGxvdyA9IGZ1bmN0aW9uKHRhcmdldCkge1xuICB2YXIgZGlyWCA9IHRoaXMueCA8IHRhcmdldC54ID8gLTEgOiAxO1xuICB0aGlzLnggLT0gZGlyWCAqIDE7XG5cbiAgdmFyIGRpclkgPSB0aGlzLnkgPCB0YXJnZXQueSA/IC0xIDogMTtcbiAgdGhpcy55IC09IGRpclkgKiAxO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBNb25zdGVyO1xuIiwiJ3VzZSBzdHJpY3QnO1xuXG52YXIgVG91Y2hhYmxlID0gcmVxdWlyZSgnLi9jb25jZXJucy90b3VjaGFibGUnKTtcbnZhciBTdGF0aWNPYmplY3QgPSByZXF1aXJlKCcuL3N0YXRpY09iamVjdCcpO1xuXG4vLyBQbGF5ZXIgaMOpcml0ZSBkZSBTdGF0aWNPYmplY3RcbnZhciBQbGF5ZXIgPSBmdW5jdGlvbihnYW1lLCB4LCB5LCBpbWFnZV9uYW1lKSB7XG4gIHRoaXMuaW1hZ2VfbmFtZSA9IGltYWdlX25hbWUgfHwgJ3BsYXllcic7XG4gIFN0YXRpY09iamVjdC5jYWxsKHRoaXMsIGdhbWUsIHgsIHksIHRoaXMuaW1hZ2VfbmFtZSk7XG59XG5QbGF5ZXIucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShTdGF0aWNPYmplY3QucHJvdG90eXBlKTtcblBsYXllci5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBTdGF0aWNPYmplY3Q7XG5cbi8vIE1peGluc1xuXy5leHRlbmQoUGxheWVyLnByb3RvdHlwZSwgVG91Y2hhYmxlLnByb3RvdHlwZSk7XG5cblBsYXllci5wcm90b3R5cGUubW92ZVVwID0gZnVuY3Rpb24oKSB7XG4gIHRoaXMueSAtPSAzO1xufTtcblxuUGxheWVyLnByb3RvdHlwZS5tb3ZlRG93biA9IGZ1bmN0aW9uKCkge1xuICB0aGlzLnkgKz0gMztcbn07XG5cblBsYXllci5wcm90b3R5cGUubW92ZUxlZnQgPSBmdW5jdGlvbigpIHtcbiAgdGhpcy54IC09IDM7XG59O1xuXG5QbGF5ZXIucHJvdG90eXBlLm1vdmVSaWdodCA9IGZ1bmN0aW9uKCkge1xuICB0aGlzLnggKz0gMztcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gUGxheWVyO1xuIiwiJ3VzZSBzdHJpY3QnO1xuXG52YXIgU3RhdGljT2JqZWN0ID0gcmVxdWlyZSgnLi9zdGF0aWNPYmplY3QnKTtcblxuLy8gUnVieSBow6lyaXRlIGRlIFN0YXRpY09iamVjdFxudmFyIFJ1YnkgPSBmdW5jdGlvbihnYW1lLCB4LCB5LCBpbWFnZV9uYW1lKSB7XG4gIHRoaXMuaW1hZ2VfbmFtZSA9IGltYWdlX25hbWUgfHwgJ3J1YnknO1xuICBTdGF0aWNPYmplY3QuY2FsbCh0aGlzLCBnYW1lLCB4LCB5LCB0aGlzLmltYWdlX25hbWUpO1xufVxuXG5SdWJ5LnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IFN0YXRpY09iamVjdDtcblJ1YnkucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShTdGF0aWNPYmplY3QucHJvdG90eXBlKTtcblxubW9kdWxlLmV4cG9ydHMgPSBSdWJ5O1xuIiwiJ3VzZSBzdHJpY3QnO1xuXG4vLyBTdGF0aWNPamVjdFxudmFyIFN0YXRpY09iamVjdCA9IGZ1bmN0aW9uKGdhbWUsIHgsIHksIGltYWdlX25hbWUpIHtcbiAgUGhhc2VyLlNwcml0ZS5jYWxsKHRoaXMsIGdhbWUsIHgsIHksIGltYWdlX25hbWUpO1xuICAvL3RoaXMuYW5jaG9yLnNldFRvKDEsIDEpO1xuICB0aGlzLmdhbWUucGh5c2ljcy5lbmFibGUodGhpcywgUGhhc2VyLlBoeXNpY3MuQVJDQURFKTtcbiAgdGhpcy5ib2R5LmNvbGxpZGVXb3JsZEJvdW5kcyA9IHRydWU7XG4gIHRoaXMuYm9keS5vdmVybGFwWCA9IDE7XG4gIHRoaXMuYm9keS5vdmVybGFwWSA9IDE7XG59XG5cblN0YXRpY09iamVjdC5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKFBoYXNlci5TcHJpdGUucHJvdG90eXBlKTtcblN0YXRpY09iamVjdC5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBTdGF0aWNPYmplY3Q7XG5cbm1vZHVsZS5leHBvcnRzID0gU3RhdGljT2JqZWN0O1xuIiwiJ3VzZSBzdHJpY3QnO1xuXG4vLyBHYW1lT3ZlclxuZnVuY3Rpb24gR2FtZU92ZXIoKSB7fTtcblxuR2FtZU92ZXIucHJvdG90eXBlID0ge1xuICBwcmVsb2FkOiBmdW5jdGlvbigpIHtcblxuICB9LFxuXG4gIGNyZWF0ZTogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHN0eWxlID0geyBmb250OiAnYm9sZCA1NXB4IEFyaWFsJywgZmlsbDogJyNmZmZmMDAnLCBhbGlnbjogJ2NlbnRlcid9O1xuICAgIHRoaXMudGl0bGVUZXh0ID0gdGhpcy5nYW1lLmFkZC50ZXh0KHRoaXMuZ2FtZS53b3JsZC5jZW50ZXJYLCAyNzUsICdHYW1lIE92ZXInLCBzdHlsZSk7XG4gICAgdGhpcy50aXRsZVRleHQuYW5jaG9yLnNldFRvKDAuNSwgMC41KTtcbiAgfSxcblxuICB1cGRhdGU6IGZ1bmN0aW9uKCkge1xuICAgIGlmKHRoaXMuZ2FtZS5pbnB1dC5hY3RpdmVQb2ludGVyLmp1c3RQcmVzc2VkKCkpIHtcbiAgICAgIHRoaXMuZ2FtZS5zdGF0ZS5zdGFydCgncGxheScpO1xuICAgIH1cbiAgfVxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBHYW1lT3ZlcjtcbiIsIid1c2Ugc3RyaWN0JztcblxudmFyIFJ1YnkgPSByZXF1aXJlKCcuLi9wcmVmYWJzL3J1YnknKTtcbnZhciBQbGF5ZXIgPSByZXF1aXJlKCcuLi9wcmVmYWJzL3BsYXllcicpO1xudmFyIE1vbnN0ZXIgPSByZXF1aXJlKCcuLi9wcmVmYWJzL21vbnN0ZXInKTtcblxuLy8gUGxheVxuZnVuY3Rpb24gUGxheSgpIHt9O1xuXG5QbGF5LnByb3RvdHlwZSA9IHtcbiAgcHJlbG9hZDogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5pbml0S2V5KCk7XG4gIH0sXG5cbiAgY3JlYXRlOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmdhbWUuYWRkLnNwcml0ZSgwLCAwLCAnYmFja2dyb3VuZCcpO1xuXG4gICAgdGhpcy5wbGF5ZXIgPSBuZXcgUGxheWVyKHRoaXMuZ2FtZSwgNTcwLCA0MDApO1xuICAgIHRoaXMuZ2FtZS5hZGQuZXhpc3RpbmcodGhpcy5wbGF5ZXIpO1xuXG4gICAgdGhpcy5ydWJ5ID0gbmV3IFJ1YnkodGhpcy5nYW1lLCA0NSwgOTUpO1xuICAgIHRoaXMuZ2FtZS5hZGQuZXhpc3RpbmcodGhpcy5ydWJ5KTtcblxuICAgIHRoaXMubW9uc3RlcnMgPSBbXTtcbiAgICB2YXIgbTtcbiAgICBfKDQpLnRpbWVzKF8uYmluZChmdW5jdGlvbihuKXtcbiAgICAgIG0gPSBuZXcgTW9uc3Rlcih0aGlzLmdhbWUsIF8ucmFuZG9tKDEwLCA0NTApLCBfLnJhbmRvbSgxMCwgNDUwKSk7XG4gICAgICB0aGlzLm1vbnN0ZXJzLnB1c2gobSk7XG4gICAgICB0aGlzLmdhbWUuYWRkLmV4aXN0aW5nKG0pO1xuICAgIH0sIHRoaXMpKTtcbiAgfSxcblxuICB1cGRhdGU6IGZ1bmN0aW9uKCkge1xuICAgIF8uZWFjaCh0aGlzLm1vbnN0ZXJzLCBfLmJpbmQoZnVuY3Rpb24obW9uc3Rlcikge1xuICAgICAgbW9uc3Rlci5mb2xsb3codGhpcy5wbGF5ZXIpO1xuICAgICAgaWYobW9uc3Rlci50b3VjaCh0aGlzLnBsYXllcikpIHtcbiAgICAgICAgdGhpcy5nYW1lLnN0YXRlLnN0YXJ0KCdnYW1lb3ZlcicsIGZhbHNlKTtcbiAgICAgIH1cbiAgICB9LCB0aGlzKSk7XG5cbiAgICBpZih0aGlzLnBsYXllci50b3VjaCh0aGlzLnJ1YnkpKSB7XG4gICAgICB0aGlzLmdhbWUuc3RhdGUuc3RhcnQoJ3dpbicsIGZhbHNlKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy51cEtleS5pc0Rvd24pIHsgdGhpcy5wbGF5ZXIubW92ZVVwKCk7IH1cbiAgICBpZiAodGhpcy5kb3duS2V5LmlzRG93bikgeyB0aGlzLnBsYXllci5tb3ZlRG93bigpOyB9XG4gICAgaWYgKHRoaXMubGVmdEtleS5pc0Rvd24pIHsgdGhpcy5wbGF5ZXIubW92ZUxlZnQoKTsgfVxuICAgIGlmICh0aGlzLnJpZ2h0S2V5LmlzRG93bikgeyB0aGlzLnBsYXllci5tb3ZlUmlnaHQoKTsgfVxuICB9LFxuXG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgLy90aGlzLmdhbWUuZGVidWcuYm9keUluZm8odGhpcy5wbGF5ZXIsIDE2LCAyNCk7XG4gICAgLy90aGlzLmdhbWUuZGVidWcuc3ByaXRlSW5mbyh0aGlzLnBsYXllcik7XG4gICAgLy90aGlzLmdhbWUuZGVidWcuYm9keSh0aGlzLnBsYXllcik7XG4gICAgLy90aGlzLmdhbWUuZGVidWcuYm9keSh0aGlzLnJ1YnkpO1xuICB9LFxuXG4gIGluaXRLZXk6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMudXBLZXkgPSB0aGlzLmdhbWUuaW5wdXQua2V5Ym9hcmQuYWRkS2V5KFBoYXNlci5LZXlib2FyZC5VUCk7XG4gICAgdGhpcy5kb3duS2V5ID0gdGhpcy5nYW1lLmlucHV0LmtleWJvYXJkLmFkZEtleShQaGFzZXIuS2V5Ym9hcmQuRE9XTik7XG4gICAgdGhpcy5sZWZ0S2V5ID0gdGhpcy5nYW1lLmlucHV0LmtleWJvYXJkLmFkZEtleShQaGFzZXIuS2V5Ym9hcmQuTEVGVCk7XG4gICAgdGhpcy5yaWdodEtleSA9IHRoaXMuZ2FtZS5pbnB1dC5rZXlib2FyZC5hZGRLZXkoUGhhc2VyLktleWJvYXJkLlJJR0hUKTtcbiAgfVxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBQbGF5O1xuIiwiJ3VzZSBzdHJpY3QnO1xuXG4vLyBQcmVsb2FkXG5mdW5jdGlvbiBQcmVsb2FkKCkge31cblxuUHJlbG9hZC5wcm90b3R5cGUgPSB7XG4gIHByZWxvYWQ6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuZ2FtZS5sb2FkLmltYWdlKCdiYWNrZ3JvdW5kJywgJy4uL2ltYWdlcy9iYWNrZ3JvdW5kLnBuZycpO1xuICAgIHRoaXMuZ2FtZS5sb2FkLmltYWdlKCdwbGF5ZXInLCAnaW1hZ2VzL3BsYXllci5wbmcnKTtcbiAgICB0aGlzLmdhbWUubG9hZC5pbWFnZSgncnVieScsICdpbWFnZXMvcnVieS5wbmcnKTtcbiAgICB0aGlzLmdhbWUubG9hZC5pbWFnZSgnZ2hvc3QxJywgJ2ltYWdlcy9naG9zdDEucG5nJyk7XG4gICAgdGhpcy5nYW1lLmxvYWQuaW1hZ2UoJ2dob3N0MicsICdpbWFnZXMvZ2hvc3QyLnBuZycpO1xuICAgIHRoaXMuZ2FtZS5sb2FkLmltYWdlKCdnaG9zdDMnLCAnaW1hZ2VzL2dob3N0My5wbmcnKTtcbiAgICB0aGlzLmdhbWUubG9hZC5pbWFnZSgnZGFya19rbmlnaHQnLCAnaW1hZ2VzL2Rhcmtfa25pZ2h0LnBuZycpO1xuICAgIHRoaXMuZ2FtZS5sb2FkLmltYWdlKCdob3JuZXQnLCAnaW1hZ2VzL2hvcm5ldC5wbmcnKTtcbiAgICB0aGlzLmdhbWUubG9hZC5pbWFnZSgndW5kZWFkJywgJ2ltYWdlcy91bmRlYWQucG5nJyk7XG4gICAgdGhpcy5nYW1lLmxvYWQuaW1hZ2UoJ2NhY3R1YXInLCAnaW1hZ2VzL2NhY3R1YXIucG5nJyk7XG4gIH0sXG5cbiAgY3JlYXRlOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmdhbWUuc3RhdGUuc3RhcnQoJ3BsYXknKTtcbiAgfSxcblxuICB1cGRhdGU6IGZ1bmN0aW9uKCkge1xuXG4gIH1cbn07XG5cbm1vZHVsZS5leHBvcnRzID0gUHJlbG9hZDtcbiIsIid1c2Ugc3RyaWN0JztcblxuLy8gV2luXG5mdW5jdGlvbiBXaW4oKSB7fTtcblxuV2luLnByb3RvdHlwZSA9IHtcbiAgcHJlbG9hZDogZnVuY3Rpb24oKSB7XG5cbiAgfSxcblxuICBjcmVhdGU6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBzdHlsZSA9IHsgZm9udDogJ2JvbGQgNTVweCBBcmlhbCcsIGZpbGw6ICcjZmZmZjAwJywgYWxpZ246ICdjZW50ZXInfTtcbiAgICB0aGlzLnRpdGxlVGV4dCA9IHRoaXMuZ2FtZS5hZGQudGV4dCh0aGlzLmdhbWUud29ybGQuY2VudGVyWCwgMjc1LCAnWW91IHdpbiAhJywgc3R5bGUpO1xuICAgIHRoaXMudGl0bGVUZXh0LmFuY2hvci5zZXRUbygwLjUsIDAuNSk7XG4gIH0sXG5cbiAgdXBkYXRlOiBmdW5jdGlvbigpIHtcbiAgICBpZih0aGlzLmdhbWUuaW5wdXQuYWN0aXZlUG9pbnRlci5qdXN0UHJlc3NlZCgpKSB7XG4gICAgICB0aGlzLmdhbWUuc3RhdGUuc3RhcnQoJ3BsYXknKTtcbiAgICB9XG4gIH1cbn07XG5cbm1vZHVsZS5leHBvcnRzID0gV2luO1xuIl19
